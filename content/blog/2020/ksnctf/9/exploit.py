import requests
import hashlib

A = 'c627e19450db746b739f41b64097d449'

B = hashlib.md5(b'GET:/~q9/flag.html').hexdigest()

# print(B)
url = 'http://ctfq.sweetduet.info:10080/~q9/flag.html'


response = requests.get(url)

# print(response)
print(response.headers)
# print(response.text)

authenticate_info = response.headers['WWW-Authenticate'].replace("Digest ", "").split(', ')
auth_table = {}
for info in authenticate_info:
  k_v = info.split('=', 1)
  auth_table[k_v[0]] = k_v[1].replace('"', '')

auth_table['nc'] = '00000001'
auth_table['cnonce'] = 'e79e26e0d17c978d'

response_txt = A + ":" + auth_table['nonce'] + ":" + auth_table['nc'] + ":" + auth_table['cnonce'] + ":" + auth_table['qop'] + ":" + B
print("response_txt: ", response_txt)
print("response_txt.encode(): ", response_txt.encode())


h_response = hashlib.md5(response_txt.encode()).hexdigest()
print("h_response: ", h_response)

auth_table['uri'] = '/~q9/flag.html'
auth_table['response'] = h_response

print(auth_table)

auth_request = "Digest username=\"q9\", realm=\"{0[realm]}\", nonce=\"{0[nonce]}\", uri=\"{0[uri]}\", algorithm={0[algorithm]}, response=\"{0[response]}\", qop={0[qop]}, nc={0[nc]}, cnonce=\"{0[cnonce]}\"".format(auth_table)
#  unq(nonce-value)
  # ":" nc-value
  # ":" unq(cnonce-value)
  # ":" unq(qop-value)


print("auth_request:", auth_request)

response = requests.get(url, headers={'Authorization' : auth_request})

print(response)
print(response.text)
